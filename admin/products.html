{% extends "base.html" %}

{% block title %}Manage Products - Apartment Hub{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 2rem;">
        <h2 style="color: var(--primary);">
            <i class="fas fa-shopping-cart"></i> Manage Products
        </h2>
        <a href="{{ url_for('admin_pending_products') }}" class="btn btn-warning">
            <i class="fas fa-clock"></i> Pending Approvals
        </a>
    </div>

    <div class="search-container">
        <form method="GET" action="{{ url_for('admin_products') }}" style="display: flex; gap: 1rem;">
            <input type="text" name="search" class="search-input" placeholder="Search products by name or category..." value="{{ search }}">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-search"></i> Search
            </button>
            {% if search %}
            <a href="{{ url_for('admin_products') }}" class="btn btn-secondary">
                <i class="fas fa-times"></i> Clear
            </a>
            {% endif %}
        </form>
    </div>

    <div class="grid grid-3">
        {% for product in products %}
        <div class="card" style="padding: 1.5rem;">
            {% if product.image %}
            <img src="{{ url_for('static', filename='uploads/' + product.image) }}" 
                 class="product-img" alt="{{ product.name }}">
            {% else %}
            <div style="width: 100%; height: 150px; background: #f8f9fa; border-radius: var(--radius); display: flex; align-items: center; justify-content: center; color: var(--gray); margin-bottom: 1rem;">
                <i class="fas fa-image" style="font-size: 2rem;"></i>
            </div>
            {% endif %}
            
            <h3 style="color: var(--primary); margin-bottom: 0.5rem; font-size: 1.1rem;">{{ product.name }}</h3>
            <p style="color: var(--gray); font-size: 0.9rem; margin-bottom: 0.5rem;">{{ product.category }}</p>
            
            <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 1rem;">
                <span style="font-size: 1.2rem; font-weight: 600; color: var(--success);">â‚¹{{ product.price }}</span>
                <span style="background: {% if product.quantity > 5 %}#10b981{% elif product.quantity > 0 %}#f59e0b{% else %}#ef4444{% endif %}; 
                      color: white; padding: 0.25rem 0.5rem; border-radius: 20px; font-size: 0.8rem;">
                    Qty: {{ product.quantity }}
                </span>
            </div>
            
            {% if product.description %}
            <p style="font-size: 0.9rem; color: var(--gray); margin-bottom: 1rem;">{{ product.description[:100] }}{% if product.description|length > 100 %}...{% endif %}</p>
            {% endif %}
            
            <div style="background: #f8f9fa; padding: 1rem; border-radius: var(--radius); margin-bottom: 1rem;">
                <div style="display: flex; justify-content: between; margin-bottom: 0.5rem;">
                    <span>Seller:</span>
                    <strong>{{ product.username }}</strong>
                </div>
                <div style="display: flex; justify-content: between; margin-bottom: 0.5rem;">
                    <span>Contact:</span>
                    <strong>{{ product.contact_number }}</strong>
                </div>
                <div style="display: flex; justify-content: between;">
                    <span>House No:</span>
                    <strong>{{ product.house_no }}</strong>
                </div>
            </div>
            
            <button onclick="deleteProduct({{ product.id }})" class="btn btn-danger btn-sm" style="width: 100%;">
                <i class="fas fa-trash"></i> Delete
            </button>
        </div>
        {% endfor %}
    </div>
    
    {% if not products %}
    <div style="text-align: center; padding: 3rem; color: var(--gray);">
        <i class="fas fa-shopping-cart" style="font-size: 3rem; margin-bottom: 1rem;"></i>
        <h3>No products found</h3>
        <p>{% if search %}Try a different search term{% else %}No products have been approved yet{% endif %}</p>
    </div>
    {% endif %}
</div>

<script>
    function deleteProduct(productId) {
        if (confirm('Are you sure you want to delete this product?')) {
            window.location.href = '/admin/delete-product/' + productId;
        }
    }
</script>
{% endblock %}